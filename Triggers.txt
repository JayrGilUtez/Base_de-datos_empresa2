
--TRIGGERS/DISPARADORES

--CREAR UNA TABLA LLAMADA ARTICULOS, CONTROL
-- UNA EMPRESA ALMACENA DATOS SOBRE LOS ARTICULOS PARA VENTAS "ARTICULOS" 
--"CONTROL" GESTIONA LAS OPERACIONES QUE SE REALIZAN EN ELLA ("ARTICULOS")

CREATE TABLE ARTICULOS(
    CODIGO NUMBER(6),
    DESCRIPCION VARCHAR(40),
    PRECIO NUMBER(6,2),
    STOCK NUMBER(4)
);

CREATE TABLE CONTROL(
    USUARIO VARCHAR(30),
    FECHA DATE,
    CODIGO NUMBER(6)

);

INSERT INTO ARTICULOS VALUES(10,'Chamarras', 250, 100);
INSERT INTO ARTICULOS VALUES(120,'Termo', 120, 50);
INSERT INTO ARTICULOS VALUES(20,'Gorras', 90, 120);
INSERT INTO ARTICULOS VALUES(300,'Cordonsito', 50, 45);
INSERT INTO ARTICULOS VALUES(150,'Mochilas', 400, 30);

-- CREAR UN TRIGER A NIVEL FILA QUE SE DISPARE "ANTES" QUE SE EJECUTE UN INSERT SOBRE LA TABLA "ARTICULOS"
-- EN EL CUERPO DEL DISPARADOR SE DEBE INGRESAR EN LA TABLA "CONTROL", EL NOMBRE DEL USUARIO QUE REALIZO EL INSERT, LA FECHA Y EL CODIGO DE ALRTICULO


CREATE OR REPLACE TRIGGER TR_INGRESAR_ART
BEFORE INSERT
ON ARTICULOS
FOR EACH ROW
BEGIN

    INSERT INTO CONTROL VALUES(USER, SYSDATE, :NEW.CODIGO);

    END TR_INGRESAR_ART;

-- REVISAR TABLAS

SELECT * FROM ARTICULOS;

SELECT * FROM CONTROL;


INSERT INTO ARTICULOS VALUES(300,'Plumas', 15, 40);


--CREAR UN DISPARADOR QUE CALCULE EL CODIGO CADA VEZ QUE SE LE INSERTE UN NUEVO REGISTRO

CREATE OR REPLACE TRIGGER TR_CODIGO
BEFORE INSERT 
ON ARTICULOS
FOR EACH ROW
BEGIN

    SELECT MAX(CODIGO)+1 INTO :NEW.CODIGO FROM ARTICULOS;
    IF :NEW.CODIGO IS NULL THEN
    :NEW.CODIGO := 1;
    END IF;


    END TR_CODIGO;


INSERT INTO ARTICULOS VALUES(20,'CARPETAS', 55, 10);

--DISABLE TRIGGERS 

--ENABLE TRIGGERS
ENABLE TRIGGER TR_CODIGO ENABLE;
--ANABLE/DISABLE ALL TRIGGERS

ALTER TABLE ARTICULOS ENABLE ALL TRIGGERS;

DROP TABLE ARTICULOS; --ESTA YA LA BORRE 

DROP TABLE CONTROL;

